@model IEnumerable<PitStopAutoShop.Web.Data.Entities.EstimateDetailTemp>

@{
    Layout = "~/Views/Shared/_LayoutDashboardPanel.cshtml";
    ViewData["Title"] = "Estimates";
    ViewData["Controller"] = "Estimates";
    ViewData["Action"] = "Create Estimate";    
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"/>



<div class="container-fluid">
    <div>
        <hr />
          <p style="text-align:center">Create a new service estimate</p> 
        <hr />          
               
       
            <table class="hover stripe compact row-border" style="display:inline-table" id="MyTable">
            <thead>
                <tr>
                    <th>
                        @Html.DisplayNameFor(model => model.Service.Name)
                    </th>                    
                    <th>
                        @Html.DisplayNameFor(model => model.Price)
                    </th> 
                    <th>
                        @Html.DisplayNameFor(model => model.Quantity)
                    </th> 
                     <th>
                        @Html.DisplayNameFor(model => model.Value)
                    </th> 
                    <th></th>
                </tr>
            </thead>
            <tbody>                     
                    @foreach (var item in Model){
                        if(item.Service != null)
                        {
                          <tr>
                            <td>
                                @Html.DisplayFor(modelItem => item.Service.Name)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Price)
                            </td> 
                            <td>
                                @Html.DisplayFor(modelItem => item.Quantity)
                            </td>   
                             <td>
                                @Html.DisplayFor(modelItem => item.Value)
                            </td>  
                            <td id="@item.Id">                
                                <a asp-action="Increase" asp-route-id="@item.Id" class="btn btn-warning"><i class="fa fa-plus"></i></a>
                                <a asp-action="Decrease" asp-route-id="@item.Id" class="btn btn-info"><i class="fa fa-minus"></i></a> 
                                <a asp-action="DeleteItem" asp-route-id="@item.Id" class="btn btn-danger" id="btnDeleteItem">Delete</a> 
                            </td>
                            </tr>
                        }                  
                    }                                  
            </tbody>
            @*<tfoot>
                <tr>
                    <td>
                        @Html.DisplayNameFor(Model => Model.Value)
                    </td>
                    <td>
                        @Html.DisplayFor(Model => Model.Value)
                    </td>
                </tr>
            </tfoot>*@
            </table>     


            <div style="margin-top:20px">
                <a asp-action="AddService" asp-route-id="@Model.First().VehicleId" class="btn btn-info btn-sm"><i class="fas fa-file-medical"></i>  Add Service</a>   
                <a asp-action="ConfirmEstimate" class="btn btn-success btn-sm" id="btnConfirm"><i class="fas fa-check-square"></i>  Finish Estimate</a>  
            </div>
    </div>
</div>


<div id="confirmDialog" class="modal fade">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Confirm Order</h4>
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-window-close"></i></button>
            </div>
            <div class="modal-body">
                <p>Do you want to finish the estimate?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="btnYesConfirm">Yes</button>
                <button type="button" class="btn btn-success" id="btnNoConfirm">No</button>
            </div>
        </div>
    </div>
</div>

<div id="deleteDialog" class="modal fade">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete Order</h4>
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-window-close"></i></button>
            </div>
            <div class="modal-body">
                <p>Do you want to delete the service from the estimate?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="btnYesDelete">Yes</button>
                <button type="button" class="btn btn-success" id="btnNoDelete">No</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="//cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
       
        $(document).ready(function() {
            $('#MyTable').DataTable({
                columnDefs: [{
                    className: 'dt-center', targets: "_all"
                }]
            });
        });

        $(document).ready(function() {
            
            var id = 0;

            $("#btnConfirm").click(function() {
                $("#confirmDialog").modal("show");
                return false;
            });

             $("#btnNoConfirm").click(function() {
                $("#confirmDialog").modal("hide");
                return false;
            });

             $("#btnYesConfirm").click(function() {
                  window.location.href = "/Estimates/ConfirmEstimate";               
            });


            $("a[id*=btnDeleteItem]").click(function() {
                    id=$(this).parent()[0].id;
                    $("#deleteDialog").modal("show");
                    return false;
            });           

            $("#btnNoDelete").click(function() {
              $("#deleteDialog").modal("hide");
                return false;
            });

            $("#btnYesDelete").click(function() {                
                window.location.href = "/Estimates/DeleteItem/"+id;
            });

        });

    </script>
}